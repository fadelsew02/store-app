// const express = require('express');
const Customers = require('../models/customers');
const sequelize = require('../models/index'); // Assurez-vous d'importer correctement votre instance Sequelize
const { QueryTypes } = require('sequelize');


module.exports = {
    // Afficher tous les fournisseurs
    display: async (req, res) => {
        const id_store = req.params.id_store;
        try {
            const sqlQuery = `
                SELECT 
                    c.nom, 
                    c.prenom, 
                    c.email, 
                    o.order_date,
                    o.total_amount,
                    o.order_id
                FROM 
                    "Customers" AS c 
                INNER JOIN 
                    "Orders" AS o
                ON 
                    c.customer_id = o.customer_id
                WHERE
                    o.store_id = ${id_store};
            `;

            const results = await sequelize.query(sqlQuery, { type: QueryTypes.SELECT });
            return res.status(200).json({'message': "Tout l'historique des clients du magasin a été récupéré avec succès", 'donnees': results});
        } catch (error) {
            return res.status(500).json({ 'message': error });
        }
    }
    
}

