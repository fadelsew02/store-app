import React, { useState, useEffect } from 'react';
import { Card, CardActions, CardMedia, Typography, CardContent, Button, Pagination, Modal, Box, TextField } from '@mui/material';
import { getEntity } from '../../../utils/requests';
import { useAuth } from '../../auth/auth'

import './panier.scss';

const Dashboard = () => {
  const [stock, setStock] = useState([]);
  const [stocks, setStocks] = useState([]);
  const [currentPage, setCurrentPage] = useState(1);
  const [itemsPerPage, setItemsPerPage] = useState(9);
  const [error, setError] = useState('');
  const [prix, setPrix] = useState(null);
  const [itemsBoughtIds, setItemsBoughtIds] = useState([]);
  const auth = useAuth();

  useEffect(() => {
    async function fetchData() {
      try {
      const fakeId = -1;
      const response = await getEntity(`stocks/display/${fakeId}`)
        if (response.data.success === true) {
          setStock(response.data.results);
        } else {
          setError('Erreur lors de la récupération du stock');
        }
      } catch (err) {
        console.error(err);
      }
    }

    fetchData();
  }, []);

  useEffect(() => {
    if (stock && stock.length > 0) {
      setStocks(stock);
    }
  }, [stock]);
  
  const handleAdd = (id) => {
      setItemsBoughtIds((prevItems)=>[...itemsBoughtIds, id])
  }

  const handlePageChange = (event, newPage) => {
    setCurrentPage(newPage);
  };


  const indexOfLastItem = currentPage * itemsPerPage;
  const indexOfFirstItem = indexOfLastItem - itemsPerPage;
  const currentItems = stocks.slice(indexOfFirstItem, indexOfLastItem);

  return (
    <div className='container'>
      {stocks && stocks.length > 0 ? currentItems.map((element, id) => (
        <Card sx={{ maxWidth: '270px', height: '360px' }} key={id}>
          <CardMedia
            component={'img'}
            image={element.url_photo}
            alt=""
            sx={{ height: '210px' }}
          />
          <CardContent sx={{ height: '110px' }}>
            <Typography gutterBottom variant="h6" sx={{ fontWeight: 'bold' }}>
              {element.item_name}
            </Typography>
            <Typography variant="body2">
              {element.price} £
            </Typography>
            <Typography variant="body2">
              Stock restant: {element.quantity}
            </Typography>
          </CardContent>
          <CardActions sx={{ float: 'right' }}>
            <Button size="small" color="primary" variant="text" onClick={() => handleAdd(element.item_id)}>Ajouter</Button>
          </CardActions>
        </Card>
      )) : <div> Récupération du stock || {error} </div>}
      <Pagination
        count={Math.ceil(stocks.length / itemsPerPage)}
        page={currentPage}
        onChange={handlePageChange}
        sx={{ position: 'fixed', bottom: '50px', right: '50px' }}
      />
    </div>
  );
}

export default Dashboard;
